<clr-main-container>

    <fema-cms-header></fema-cms-header>

    <div class="content-container">

        <fema-cms-nav></fema-cms-nav>

        <main class="content-area"
              #clrContentArea>

            <h1>Edit Video: {{videoForm?.get('title')?.value}}</h1>

            <fema-cms-alert-on-action
                [errorOnInit]="errorOnInit"
                [responseOnAction]="responseOnAction"
                [isLoading]="!videoForm?.get('id')?.value && !errorOnInit"
                [isFailed]="errorOnInit"
                (retry)="initialSetup()"
                (close)="responseOnAction = $event"></fema-cms-alert-on-action>

            <form
                [formGroup]="videoForm"
                (ngSubmit)="checkFormValidity($event)"
                *ngIf="videoForm?.get('id')?.value && !errorOnInit">

                <div class="row">

                    <div class="col-xl-8 col-lg-12 col-md-12 col-sm-12 col-xs-12">

                        <div class="form-group">

                            <label>Video</label>

                            <iframe #domVideo
                                    [src]="videoForm?.get('url')?.value | safeUrl"
                                    allowtransparency="true"
                                    frameborder="0"
                                    scrolling="no"
                                    class="wistia_embed"
                                    name="wistia_embed"
                                    allowfullscreen="allowfullscreen"
                                    mozallowfullscreen="mozallowfullscreen"
                                    webkitallowfullscreen="webkitallowfullscreen"
                                    oallowfullscreen="oallowfullscreen"
                                    msallowfullscreen="msallowfullscreen"
                                    width="100%"
                                    [height]="videoResolution?.height"></iframe>

                        </div>

                    </div>

                    <div class="col-xl-4 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="form-group">
                            <label>Viewable</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="viewableToggle" formControlName="viewable"/>
                                <label for="viewableToggle">{{videoForm?.getRawValue()?.viewable ? 'Yes' :
                                    'No'}}</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Show on FIFTUBE Home</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="showOnHomeToggle" formControlName="showOnHome"/>
                                <label for="showOnHomeToggle">{{videoForm?.getRawValue()?.showOnHome ? 'Yes' :
                                    'No'}}</label>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="form-group">

                    <label class="required">URL</label>

                    <label for="urlField"
                           aria-haspopup="true"
                           role="tooltip"
                           class="tooltip tooltip-validation tooltip-md"
                           [class.invalid]="invalidField('url')">

                        <input type="text"
                               id="urlField"
                               placeholder="URL"
                               size="100"
                               readonly
                               formControlName="url"/>

                        <span class="tooltip-content"
                              *ngIf="invalidField('url', 'required')">
                            URL will be automatically generated by uploaded video
                        </span>

                    </label>

                </div>

                <div class="form-group">

                    <label class="required">Video Title</label>

                    <label for="videoTitleField" aria-haspopup="true" role="tooltip"
                           class="tooltip tooltip-validation tooltip-md"
                           [class.invalid]="invalidField('title') || videoIsUnique">

                        <input type="text"
                               id="videoTitleField"
                               placeholder="Video Title"
                               size="100"
                               maxlength="250"
                               formControlName="title"/>

                        <span class="tooltip-content"
                              *ngIf="invalidField('title', 'required')">
                            Title must be filled
                        </span>

                        <span class="tooltip-content"
                              *ngIf="invalidField('title', 'unique')">
                                Title must be unique
                        </span>

                    </label>

                </div>

                <div class="form-group">

                    <label class="required">Description</label>

                    <label for="descriptionField"
                           aria-haspopup="true"
                           role="tooltip"
                           class="tooltip tooltip-validation tooltip-md"
                           [class.invalid]="invalidField('description')">

                        <input type="text"
                               id="descriptionField"
                               placeholder="Description"
                               size="100"
                               maxlength="300"
                               formControlName="description"/>

                        <span *ngIf="invalidField('description', 'required')"
                              class="tooltip-content">
                            Description must be filled
                        </span>

                    </label>

                </div>

                <div class="form-group">

                    <label class="required">Category</label>

                    <label for="categorySelect"
                           aria-haspopup="true"
                           role="tooltip"
                           class="tooltip tooltip-validation tooltip-md"
                           [class.invalid]="invalidField('category')">

                        <span class="select">

                            <select id="categorySelect"
                                    [formControlName]="'category'">

                                <option *ngFor="let category of categories"
                                        [value]="category?.value">
                                    {{category?.label}}
                                </option>

                            </select>

                        </span>

                        <span class="tooltip-content tooltip-content--show"
                              style="margin-left:1.5cm"
                              *ngIf="invalidField('category', 'required')">
                            Category must be filled
                        </span>

                    </label>

                </div>

                <datalist id="feedbackSuggestion">

                    <option *ngFor="let feedback of suggestion?.feedbacks"
                            [ngValue]="feedback">
                        {{feedback?.templateName}}
                    </option>

                </datalist>

                <div class="form-group">

                    <label for="feedbackField">Feedback</label>

                    <input type="text"
                           id="feedbackField"
                           placeholder="Feedback"
                           size="100"
                           formControlName="feedback"
                           (change)="checkFeedback($event)"
                           [attr.list]="feedbackDatalist"/>

                </div>

                <br/>

                <div class="btn-group btn-primary btn-right">

                    <button type="submit"
                            class="btn btn-icon">

                        <clr-icon shape="floppy"></clr-icon>

                        Save

                    </button>

                    <button type="button"
                            class="btn btn-icon btn-danger"
                            (click)="$event?.preventDefault(); uiState.deleteModalIsOpen = true;">

                        <clr-icon shape="trash"></clr-icon>

                        Delete

                    </button>

                    <button type="button"
                            class="btn btn-icon"
                            (click)="$event?.preventDefault(); uiState.cancelModalIsOpen = true;">

                        <clr-icon shape="undo"></clr-icon>

                        Cancel

                    </button>

                </div>

            </form>

            <fema-cms-modal-cancel
                [(isOpen)]="uiState.cancelModalIsOpen"
                [returnLink]="'/video/search'"></fema-cms-modal-cancel>

            <fema-cms-modal-delete
                [(isOpen)]="uiState.deleteModalIsOpen"
                (delete)="delete()"
                [(isOpenSuccess)]="uiState.deleteSuccessModalIsOpen"
                [returnLink]="'/video/search'"></fema-cms-modal-delete>

            <fema-cms-modal-save
                [(isOpen)]="uiState.saveModalIsOpen"
                (save)="save()"
                [(isOpenSuccess)]="uiState.saveSuccessModalIsOpen"
                [returnLink]="'/video/search'"></fema-cms-modal-save>

        </main>

    </div>

</clr-main-container>
